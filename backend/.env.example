# ============================================================================
# Nest Egg — Environment Configuration
# ============================================================================
# Copy this file to .env and fill in the values.
# Lines starting with # are comments. Blank values disable the feature.

# ── Core ────────────────────────────────────────────────────────────────────
ENVIRONMENT=development            # development | staging | production
DEBUG=true                         # Set false in production
APP_BASE_URL=http://localhost:5173 # Public URL for email links (reject localhost in prod)

# ── Database ────────────────────────────────────────────────────────────────
DATABASE_URL=postgresql+asyncpg://nestegg:nestegg_dev_password@localhost:5432/nestegg_dev
DB_POOL_SIZE=20                    # Increase for high-traffic deployments
DB_MAX_OVERFLOW=10

# ── Redis ───────────────────────────────────────────────────────────────────
REDIS_URL=redis://localhost:6379/0

# ── Security ────────────────────────────────────────────────────────────────
# REQUIRED — generate with: openssl rand -hex 32
SECRET_KEY=dev-secret-key-change-in-production-generate-with-openssl-rand-hex-32
# REQUIRED — generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
MASTER_ENCRYPTION_KEY=
# Key rotation: set ENCRYPTION_KEY_V1 to the old key and increment ENCRYPTION_CURRENT_VERSION
ENCRYPTION_KEY_V1=
ENCRYPTION_CURRENT_VERSION=1

# ── CORS / Trusted Hosts ───────────────────────────────────────────────────
CORS_ORIGINS=http://localhost:3000,http://localhost:5173
# REQUIRED in production — set to your actual domains
ALLOWED_HOSTS=*

# ── Celery (background jobs) ───────────────────────────────────────────────
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/0

# ── Plaid API (bank linking) ───────────────────────────────────────────────
PLAID_CLIENT_ID=
PLAID_SECRET=
PLAID_ENV=sandbox                  # sandbox | development | production
PLAID_WEBHOOK_SECRET=
PLAID_ENABLED=true

# ── Teller API (bank linking alternative) ──────────────────────────────────
TELLER_APP_ID=
TELLER_API_KEY=
TELLER_ENV=sandbox
TELLER_WEBHOOK_SECRET=
TELLER_ENABLED=true
TELLER_CERT_PATH=                  # Path to Teller mTLS certificate (.pem)

# ── Market Data (investment prices) ────────────────────────────────────────
MARKET_DATA_PROVIDER=yahoo_finance # yahoo_finance | alpha_vantage | finnhub
ALPHA_VANTAGE_API_KEY=
FINNHUB_API_KEY=
PRICE_REFRESH_COOLDOWN_HOURS=6

# ── Property Valuation ─────────────────────────────────────────────────────
RENTCAST_API_KEY=                  # Recommended — 50 free calls/month
ATTOM_API_KEY=
ZILLOW_RAPIDAPI_KEY=              # Not recommended — may violate Zillow ToS

# ── Vehicle Valuation ──────────────────────────────────────────────────────
MARKETCHECK_API_KEY=

# ── Email (SMTP) ───────────────────────────────────────────────────────────
SMTP_HOST=                         # e.g. smtp.gmail.com — leave blank to disable emails
SMTP_PORT=587
SMTP_USERNAME=
SMTP_PASSWORD=
SMTP_FROM_EMAIL=noreply@nestegg.app
SMTP_FROM_NAME=Nest Egg
SMTP_USE_TLS=true

# ── Monitoring ─────────────────────────────────────────────────────────────
SENTRY_DSN=                        # Optional Sentry error tracking
LOG_LEVEL=INFO
LOG_FORMAT=text                    # text | json (use json in production)
METRICS_ENABLED=true
METRICS_PASSWORD=metrics_admin     # CHANGE IN PRODUCTION

# ── Identity Provider Chain ────────────────────────────────────────────────
# Ordered comma-separated list. 'builtin' = app's own JWT.
IDENTITY_PROVIDER_CHAIN=builtin
# Cognito
IDP_COGNITO_ISSUER=
IDP_COGNITO_CLIENT_ID=
# Keycloak
IDP_KEYCLOAK_ISSUER=
IDP_KEYCLOAK_CLIENT_ID=
# Okta
IDP_OKTA_ISSUER=
IDP_OKTA_CLIENT_ID=
# Google
IDP_GOOGLE_CLIENT_ID=

# ── Storage ────────────────────────────────────────────────────────────────
STORAGE_BACKEND=local              # local | s3
LOCAL_UPLOAD_DIR=/tmp/nestegg-uploads
AWS_S3_BUCKET=
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# ── Enterprise: Data Retention ─────────────────────────────────────────────
# Set to number of days to auto-purge old transactions (e.g., 2555 = ~7 years).
# Leave unset for indefinite retention (default).
# DATA_RETENTION_DAYS=
# Safety: set to false only after verifying the retention window is correct.
DATA_RETENTION_DRY_RUN=true

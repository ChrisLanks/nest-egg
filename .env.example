# Database
DATABASE_URL=postgresql+asyncpg://nestegg:nestegg_dev_password@localhost:5432/nestegg

# Redis
REDIS_URL=redis://localhost:6379/0

# Security (Generate secure keys for production!)
# Generate with: openssl rand -hex 32
SECRET_KEY=dev-secret-key-change-in-production-generate-with-openssl

# Encryption key rotation:
#   Current key — used for all new writes.
#   Generate a valid Fernet key with:
#     python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
MASTER_ENCRYPTION_KEY=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef
ENCRYPTION_CURRENT_VERSION=1   # Increment to 2 when rotating
#
# --- Rotation procedure ---
# 1. Generate a new key (command above)
# 2. Move current MASTER_ENCRYPTION_KEY → ENCRYPTION_KEY_V1 below
# 3. Set MASTER_ENCRYPTION_KEY = <new key>
# 4. Increment ENCRYPTION_CURRENT_VERSION (e.g. 1 → 2)
# 5. Deploy — old V1 rows decrypt fine; new writes use new version prefix
# 6. Optionally re-encrypt all rows with a one-time migration script
#
# Previous key — decryption only after rotation (leave unset on first deploy):
# ENCRYPTION_KEY_V1=<previous MASTER_ENCRYPTION_KEY value here>

# Plaid API (Get from https://dashboard.plaid.com/signup)
# Production: ~$0.50-$2.00/account/month
PLAID_CLIENT_ID=your_plaid_client_id
PLAID_SECRET=your_plaid_secret
PLAID_ENV=sandbox
PLAID_WEBHOOK_SECRET=your_webhook_secret
PLAID_ENABLED=true

# Teller API (Get from https://teller.io) ⭐ RECOMMENDED
# FREE: 100 accounts/month in production!
# After 100: $1/account/month (half the price of Plaid)
TELLER_APP_ID=your_teller_app_id
TELLER_API_KEY=your_teller_api_key
TELLER_ENV=sandbox
TELLER_WEBHOOK_SECRET=your_webhook_secret
TELLER_ENABLED=true
# mTLS certificate issued by Teller (download from Teller dashboard)
# Required for all Teller API calls - without this, API requests will be rejected
TELLER_CERT_PATH=/path/to/teller/certificate.pem

# Financial Data APIs (Optional - for investment metadata enrichment)
# Alpha Vantage: Primary source for market cap, sector, industry, country data
# Register (free) at: https://www.alphavantage.co/support/#api-key
# Rate limit: 25 calls/day, 5 calls/minute
ALPHA_VANTAGE_API_KEY=your_alpha_vantage_api_key_here

# Finnhub: Backup source for financial data
# Register (free) at: https://finnhub.io/register
# Rate limit: 60 calls/minute
FINNHUB_API_KEY=your_finnhub_api_key_here

# Celery
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/0

# Security & Authentication
MAX_LOGIN_ATTEMPTS=5  # Number of failed login attempts before account lockout
ACCOUNT_LOCKOUT_MINUTES=30  # Duration of account lockout after max failed attempts
ALLOWED_HOSTS=*  # In production, set to specific domains: app.nestegg.com,api.nestegg.com

# Database Performance
DB_POOL_SIZE=20  # Connection pool size (increase to 50-100 for production)
DB_MAX_OVERFLOW=10  # Max overflow connections beyond pool size

# Market Data Caching
# MARKET_DATA_CACHE_TTL=300  # Cache TTL in seconds (5 minutes default)

# Monitoring & Logging
LOG_LEVEL=INFO
LOG_FORMAT=text  # 'text' for development, 'json' for production
ENVIRONMENT=development  # development, staging, production
DEBUG=true              # Set to false in production (disables Swagger/ReDoc/OpenAPI)
METRICS_ENABLED=true
# Prometheus metrics are served on a SEPARATE admin port (not the main API port).
# Access: curl -u admin:metrics_admin http://localhost:9090/metrics
METRICS_ADMIN_PORT=9090
METRICS_USERNAME=admin
METRICS_PASSWORD=metrics_admin  # CHANGE IN PRODUCTION

# File Storage (CSV uploads, attachments)
# "local" stores files on disk (dev-friendly default)
# "s3" stores files in AWS S3 (recommended for production / multi-container)
STORAGE_BACKEND=local
LOCAL_UPLOAD_DIR=/tmp/nestegg-uploads
# --- S3 settings (only needed when STORAGE_BACKEND=s3) ---
# Leave AWS_ACCESS_KEY_ID unset to use the EC2/ECS IAM instance role (recommended in prod)
# AWS_S3_BUCKET=my-nestegg-uploads
# AWS_REGION=us-east-1
# AWS_S3_PREFIX=csv-uploads/
# AWS_ACCESS_KEY_ID=AKIA...          # omit to use IAM role
# AWS_SECRET_ACCESS_KEY=...          # omit to use IAM role

# Compliance
TERMS_VERSION=2026-02  # Bump this when Terms of Service or Privacy Policy changes

# Optional: Sentry (for error tracking)
# SENTRY_DSN=your_sentry_dsn

# ── Identity Provider Chain ─────────────────────────────────────────────────
# Ordered comma-separated list of active providers.
# 'builtin' = app's own HS256 JWT (always available as fallback).
# First provider whose JWT issuer/alg matches the incoming token wins.
#
# Examples:
#   IDENTITY_PROVIDER_CHAIN=builtin                     ← dev default
#   IDENTITY_PROVIDER_CHAIN=cognito,builtin             ← Cognito + fallback
#   IDENTITY_PROVIDER_CHAIN=keycloak,okta,google,builtin
IDENTITY_PROVIDER_CHAIN=builtin

# --- AWS Cognito (add 'cognito' to IDENTITY_PROVIDER_CHAIN to enable) ---
# Pool HTTPS endpoint from the AWS Cognito console.
# IDP_COGNITO_ISSUER=https://cognito-idp.us-east-1.amazonaws.com/us-east-1_XXXXXXXXX
# IDP_COGNITO_CLIENT_ID=your_cognito_app_client_id
# IDP_COGNITO_ADMIN_GROUP=nest-egg-admins   # Cognito group → org admin

# --- Keycloak (add 'keycloak' to IDENTITY_PROVIDER_CHAIN to enable) ---
# IDP_KEYCLOAK_ISSUER=https://keycloak.example.com/realms/nest-egg
# IDP_KEYCLOAK_CLIENT_ID=nest-egg
# IDP_KEYCLOAK_ADMIN_GROUP=nest-egg-admins
# IDP_KEYCLOAK_GROUPS_CLAIM=groups          # JWT claim that contains group list

# --- Okta (add 'okta' to IDENTITY_PROVIDER_CHAIN to enable) ---
# IDP_OKTA_ISSUER=https://company.okta.com/oauth2/default
# IDP_OKTA_CLIENT_ID=your_okta_client_id
# IDP_OKTA_GROUPS_CLAIM=groups

# --- Google (add 'google' to IDENTITY_PROVIDER_CHAIN to enable) ---
# Paste the "Web application" client ID from the Google Cloud Console.
# IDP_GOOGLE_CLIENT_ID=your_google_oauth2_client_id.apps.googleusercontent.com
